@model IEnumerable<Course>
@{
    ViewData["Title"] = "Equalized Courses";
}

<!DOCTYPE html>
<html>
<head>
    <title>Equalize Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        .card-header {
            background-color: #dc3545;
            color: white;
        }
    </style>
</head>

<body>
    <div class="background-image"></div>
    <div class="container">
        <header>
        </header>

        <nav>
        </nav>

        <main>
            <div class="card">
                <div class="card-header custom-darker-danger">
                    <h3>معلومات الطالب</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>المنشأة السابقة</label>
                                <p id="institutionId"></p>
                            </div>
                            <div class="form-group">
                                <label>التخصص</label>
                                <p id="major"></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>اسم الطالب</label>
                                <p id="studentName"></p>
                            </div>
                            <div class="form-group">
                                <label>الرقم الجامعي للطالب</label>
                                <p id="studentId"></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>الجنسية</label>
                                <p id="nationality"></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>الحالة</label>
                                <p id="case"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header custom-darker-danger">
                    <h3>اختيار المواد المجتازة</h3>
                </div>
                <div class="text-center mt-4">
                    <button type="button" class="btn btn-lg custom-darker-danger rounded-pill mt-4" onclick="print()">طباعة بصيغة PDF</button>
                </div>
                <div class="card-body">
                    <table class="table" id="course">
                        <thead>
                            <tr class="custom-darker-danger">
                                <th>اسم المادة</th>
                                <th>وصف المادة</th>
                                <th>وزن المادة</th>
                                <th>مجتازة</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</body>
</html>

<script>
    $(document).ready(function () {
        function getQueryParam(param) {
            let urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        $('#institutionId').text(getQueryParam('institutionId'));
        $('#major').text(getQueryParam('major'));
        $('#studentName').text(getQueryParam('studentName'));
        $('#studentId').text(getQueryParam('studentId'));
        $('#nationality').text(getQueryParam('nationality'));
        $('#case').text(getQueryParam('case'));

        $('#printBtn').click(function () {
            print();
        });

        function print() {
            console.log("Printing as PDF");
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            html2canvas(document.querySelector("main")).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgProps = doc.getImageProperties(imgData);
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                doc.save('test.pdf');
            }).catch(error => {
                console.error('Error generating PDF: ', error);
            });
        }
    });
</script>
